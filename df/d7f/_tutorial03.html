<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chi-Tech: Tutorial 3: Basic transport simulation</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Logo2_Small.bmp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Chi-Tech
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('df/d7f/_tutorial03.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 3: Basic transport simulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Let us tackle a basic transport simulation on a 1D mesh<br />
 </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \hat{\Omega} \nabla \Psi(\hat{\Omega}) + \sigma_t \Psi (\hat{\Omega}) = \int_{\hat{\Omega}} \sigma_s (\hat{\Omega}' \to \hat{\Omega}) \Psi (\hat{\Omega}').d\hat{\Omega}' + q(\hat{\Omega}) \]" src="../../form_78.png"/>
</p>
<h2>Step 1 - Create your input file, open it in a text editor</h2>
<p>As before, go to the directory of your choosing and make an input file of your choosing.</p>
<h2>Step 2 - Create a mesh</h2>
<p>A 1D simulation is created from a Line-mesh. The line mesh expects to be populated by a number of points supplied by a lua table.</p>
<div class="fragment"><div class="line">mesh={}</div><div class="line">N=5000</div><div class="line">L=30.0</div><div class="line">xmin = 0.0</div><div class="line">dx = L/N</div><div class="line"><span class="keywordflow">for</span> i=1,(N+1) <span class="keywordflow">do</span></div><div class="line">    k=i-1</div><div class="line">    mesh[i] = xmin + k*dx</div><div class="line">end</div><div class="line">line_mesh = <a class="code" href="../../d5/dac/group___lua_line_mesh.html#ga3ec7ef07f330a4f62aaaaa2e5b1231cf">chiLineMeshCreateFromArray</a>(mesh)</div></div><!-- fragment --><p>As soon as we have a line mesh we can now proceed as before.</p>
<div class="fragment"><div class="line">region1 = <a class="code" href="../../df/dda/group___lua_region.html#ga43a351b3c89be7a78be0fd2572fcda99">chiRegionCreate</a>()</div><div class="line"><a class="code" href="../../df/dda/group___lua_region.html#ga6ec0426adb51bd6d8956df8655823d9f">chiRegionAddLineBoundary</a>(region1,line_mesh);</div><div class="line"></div><div class="line">-- Create meshers</div><div class="line"><a class="code" href="../../d1/d9b/group___lua_surface_mesher.html#ga0c2548f1aad3017bd1aa8732fe8ae3ba">chiSurfaceMesherCreate</a>(SURFACEMESHER_PREDEFINED);</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher.html#ga51e2ce3f00d88c1bb3811b3361f0c2df">chiVolumeMesherCreate</a>(<a class="code" href="../../dd/dcb/chi__volumemesher_8h.html#a4f1c716073e6fbecbf1adfab92e0e02c">VOLUMEMESHER_LINEMESH1D</a>);</div><div class="line"></div><div class="line">-- Execute meshing</div><div class="line"><a class="code" href="../../d1/d9b/group___lua_surface_mesher.html#gae977f4ef9c66248e03bbc9c2a5e9c24b">chiSurfaceMesherExecute</a>();</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher.html#ga2cbae637b293223c824105bf422c0ab8">chiVolumeMesherExecute</a>();</div><div class="line"></div><div class="line">-- Set Material IDs</div><div class="line">vol0 = <a class="code" href="../../d9/d32/group___lua_logic_volumes.html#ga5ecdd09775b38d1aa8cbfa4322a6ae0c">chiLogicalVolumeCreate</a>(<a class="code" href="../../d9/df5/chi__mesh__logicalvolume_8h.html#ab27b91d4128c63b2fa1ff9d4c7f179a5">RPP</a>,-1000,1000,-1000,1000,-1000,1000)</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher.html#ga52aada794be1a72c2c5efb8a442e9e1f">chiVolumeMesherSetProperty</a>(MATID_FROMLOGICAL,vol0,0)</div></div><!-- fragment --><p>Some notably new items is the different volume mesher (VOLUMEMESHER_LINEMESH1D). Note also that even though there is no notion of a surfacemesher we still need to use a pass-through SurfaceMesher. This helps to keep the coding pipeline simple.</p>
<p>We also set the material id's the same we we do any mesh format.</p>
<h2>Step 3 - Add a material with a transport cross-section</h2>
<p>Similar to the diffusion tutorial we have to create a material, then add a property to it, and then to set the property.</p>
<div class="fragment"><div class="line">material0 = <a class="code" href="../../d7/d11/group___lua_physics_materials.html#ga8c9e57e5b4e662f31710a8039455a50e">chiPhysicsAddMaterial</a>(<span class="stringliteral">&quot;Test Material&quot;</span>);</div><div class="line"></div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials.html#gab090ff17a8c3788f88574c481edd15f8">chiPhysicsMaterialAddProperty</a>(material0,TRANSPORT_XSECTIONS)</div><div class="line"></div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials.html#ga18f1ed6d994830d877ef3051fd540e57">chiPhysicsMaterialSetProperty</a>(material0,</div><div class="line">                              TRANSPORT_XSECTIONS,</div><div class="line">                              SIMPLEXS1,</div><div class="line">                              1,     --Num grps</div><div class="line">                              1.0,   --Sigma_t</div><div class="line">                              1.0)   --Scattering ratio</div></div><!-- fragment --><p>The general material property TRANSPORT_XSECTIONS is used for non-fission transport materials. Simple cross-sections can be specified by using the operation SIMPLEXS1 which expects the number of groups, the total cross-section, and then the scattering ratio.</p>
<h2>Step 4 - Add Transport physics</h2>
<div class="fragment"><div class="line">phys1 = <a class="code" href="../../d7/d08/group___lua_n_p_t.html#gaa8ecbfc58922b856b87105c25a14ac1e">chiLBSCreateSolver</a>()</div><div class="line"><a class="code" href="../../dc/d4e/group___lua_solver.html#gab5fe2a50838ea4c4f573979d6d7540e4">chiSolverAddRegion</a>(phys1,region1)</div><div class="line"></div><div class="line"><a class="code" href="../../d5/d03/group___lua_l_b_s_groupsets.html#ga32c2f830ac80004b0384f279b467933b">chiLBSCreateGroup</a>(phys1)</div><div class="line"></div><div class="line">pquad = <a class="code" href="../../de/d37/group___lua_quadrature.html#ga9600f3a9c8ef7a0f97a27d7317ebb3b3">chiCreateProductQuadrature</a>(<a class="code" href="../../dc/d2a/product__quadrature_8h.html#a1c3b5a7292aedaed8300b88c0e4512ac">GAUSS_LEGENDRE</a>,32)</div><div class="line"></div><div class="line">--========== Groupset def</div><div class="line">gs0 = <a class="code" href="../../d5/d03/group___lua_l_b_s_groupsets.html#ga4a61dcf3687356def2adc1c720c1efd9">chiLBSCreateGroupset</a>(phys1)</div><div class="line"><a class="code" href="../../d5/d03/group___lua_l_b_s_groupsets.html#ga439b51d0e2b4bfb17a8c5268ed2fe638">chiLBSGroupsetAddGroups</a>(phys1,gs0,0,0)</div><div class="line"><a class="code" href="../../d5/d03/group___lua_l_b_s_groupsets.html#ga38482eab97509e103bf59f27deea93c5">chiLBSGroupsetSetQuadrature</a>(phys1,gs0,pquad)</div><div class="line"></div><div class="line">--========== Boundary conditions</div><div class="line">bsrc = {0.5}</div><div class="line"><a class="code" href="../../d7/d08/group___lua_n_p_t.html#ga0ff2334b7745f760ecdfbf378b668841">chiLBSSetProperty</a>(phys1,BOUNDARY_CONDITION,</div><div class="line">                  ZMIN,LBSBoundaryTypes.INCIDENT_ISOTROPIC,bsrc);</div><div class="line"></div><div class="line">--========== Solvers</div><div class="line"><a class="code" href="../../d7/d08/group___lua_n_p_t.html#ga0ff2334b7745f760ecdfbf378b668841">chiLBSSetProperty</a>(phys1,DISCRETIZATION_METHOD,PWLD1D)</div><div class="line"><a class="code" href="../../d7/d08/group___lua_n_p_t.html#ga0ff2334b7745f760ecdfbf378b668841">chiLBSSetProperty</a>(phys1,SCATTERING_ORDER,0)</div></div><!-- fragment --><p>A transport solver is invoked by using a call to <a class="el" href="../../d7/d08/group___lua_n_p_t.html#gaa8ecbfc58922b856b87105c25a14ac1e">chiLBSCreateSolver()</a>. This creates a derived physics solver so the mesh region gets added to the solver using the generic call <a class="el" href="../../dc/d4e/group___lua_solver.html#gab5fe2a50838ea4c4f573979d6d7540e4">chiSolverAddRegion()</a>. Past this point we need to create the single required group with <a class="el" href="../../d5/d03/group___lua_l_b_s_groupsets.html#ga32c2f830ac80004b0384f279b467933b">chiLBSCreateGroup()</a> and then a quadrature rule for integration of the angular fluxes. Since we are dealing with a 1D simulation we will be integration over theta translating to a cosine from -1 to 1 and therefore the appropriate quadrature rule would be a Gauss-Legendre quadrature rule. For this we use a call to <a class="el" href="../../de/d37/group___lua_quadrature.html#ga9600f3a9c8ef7a0f97a27d7317ebb3b3">chiCreateProductQuadrature()</a> and specifying GAUSS_LEGENDRE as the rule and 32 number of discrete angles.</p>
<p>The next step in the process is to assign a group-set. Group-sets are very useful aggregation features in higher dimension simulations but here we only have a single groupset. The group-set is created with a call to <a class="el" href="../../d5/d03/group___lua_l_b_s_groupsets.html#ga4a61dcf3687356def2adc1c720c1efd9">chiLBSCreateGroupset()</a>. Next we add groups to the group-set using a range, however, since we only have one group here the range will be 0 to 0. The final piece of a groupset is to add a quadrature which is achieved with a call to <a class="el" href="../../d5/d03/group___lua_l_b_s_groupsets.html#ga38482eab97509e103bf59f27deea93c5">chiLBSGroupsetSetQuadrature()</a>.</p>
<h2>Step 5 - Initialize and Execute</h2>
<div class="fragment"><div class="line"><a class="code" href="../../d7/d08/group___lua_n_p_t.html#ga64539ea4595365ed48c1e8458028c443">chiLBSInitialize</a>(phys1)</div><div class="line"><a class="code" href="../../d7/d08/group___lua_n_p_t.html#ga4325f93255469d8c33115055a0a41964">chiLBSExecute</a>(phys1)</div></div><!-- fragment --><p>This should be intuitive.</p>
<h2>Step 6 - Add output</h2>
<div class="fragment"><div class="line">fflist,count = <a class="code" href="../../d7/d08/group___lua_n_p_t.html#ga5d938e5ed990f5c34953f0d6928cbbf4">chiLBSGetScalarFieldFunctionList</a>(phys1)</div><div class="line"></div><div class="line">cline = <a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga82defddaf5f08f70c831b102cdde64b2">chiFFInterpolationCreate</a>(LINE)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga96bf9fbe2e1011f7a6f108b06fb21357">chiFFInterpolationSetProperty</a>(cline,LINE_FIRSTPOINT,0.0,0.0,0.0+xmin)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga96bf9fbe2e1011f7a6f108b06fb21357">chiFFInterpolationSetProperty</a>(cline,LINE_SECONDPOINT,0.0,0.0, L+xmin)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga96bf9fbe2e1011f7a6f108b06fb21357">chiFFInterpolationSetProperty</a>(cline,LINE_NUMBEROFPOINTS, 50)</div><div class="line"></div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga96bf9fbe2e1011f7a6f108b06fb21357">chiFFInterpolationSetProperty</a>(cline,ADD_FIELDFUNCTION,fflist[1])</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga718dc33822113a7a19e3d88f58af98f8">chiFFInterpolationInitialize</a>(cline)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga9b2c18e031eadedad41cf0066554904f">chiFFInterpolationExecute</a>(cline)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol.html#ga88b69c2bef2c7933f39d7f0de591c6c1">chiFFInterpolationExportPython</a>(cline)</div><div class="line"></div><div class="line">if (<a class="code" href="../../d4/df9/_global_values_8h.html#a96d95263222d9d1de8e46682655c2246">chi_location_id</a> == 0) then</div><div class="line">    local handle = io.popen(&quot;python ZLFFI00.py&quot;)</div><div class="line">end</div></div><!-- fragment --><p>Instead of using a SLICE interpolator we instead opt to use a LINE interpolator. A line-interpolator needs two points as the initial and final point (i.e. LINE_FIRSTPOINT and LINE_SECONDPOINT) as well as the total number of points LINE_NUMBEROFPOINTS. Finally add the first available scalar field field function to the interpolator.</p>
<p>The output should look as follows:</p>
<div class="image">
<img src="../../Tut3Output.png" alt="Tut3Output.png" width="350px"/>
<div class="caption">
Figure 1 - Output of the 1D simulation</div></div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">index</a></li><li class="navelem"><a class="el" href="../../d8/d2d/_tutorial00.html">Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
