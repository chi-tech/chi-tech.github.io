<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chi-Tech: Tutorial 3: Basic transport simulation</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Logo2_Small.bmp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Chi-Tech
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('df/d7f/_tutorial03.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 3: Basic transport simulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Let us tackle a basic transport simulation and perform a 1D simulation<br />
 </p><p class="formulaDsp">
\[ \hat{\Omega} \nabla \Psi(\hat{\Omega}) + \sigma_t \Psi (\hat{\Omega}) = \int_{\hat{\Omega}} \sigma_s (\hat{\Omega}&#39; \to \hat{\Omega}) \Psi (\hat{\Omega}&#39;).d\hat{\Omega}&#39; + q(\hat{\Omega}) \]
</p>
<h2>Step 1 - Create your input file, open it in a text editor</h2>
<p>As before, go to the directory of your choosing and make an input file of your choosing.</p>
<h2>Step 2 - Create a mesh</h2>
<p>A 1D simulation is created from a Line-mesh. The line mesh expects to be populated by a number of points supplied by a lua table.</p>
<div class="fragment"><div class="line">mesh={}</div><div class="line">N=5000</div><div class="line">L=30.0</div><div class="line">xmin = 0.0</div><div class="line">dx = L/N</div><div class="line"><span class="keywordflow">for</span> i=1,(N+1) <span class="keywordflow">do</span></div><div class="line">    k=i-1</div><div class="line">    mesh[i] = xmin + k*dx</div><div class="line">end</div><div class="line">line_mesh = <a class="code" href="../../d5/dac/group___lua_line_mesh_ga00537255b19fb1d7e13254b81d63c65e.html#ga00537255b19fb1d7e13254b81d63c65e">chiLineMeshCreateFromArray</a>(mesh)</div></div><!-- fragment --><p>As soon as we have a line mesh we can now proceed as before.</p>
<div class="fragment"><div class="line">region1 = <a class="code" href="../../df/dda/group___lua_region_ga12d91bac4cbde16ef605143f6437e806.html#ga12d91bac4cbde16ef605143f6437e806">chiRegionCreate</a>()</div><div class="line"><a class="code" href="../../df/dda/group___lua_region_ga38021490f4606ccd7a12e16e4c9492bf.html#ga38021490f4606ccd7a12e16e4c9492bf">chiRegionAddLineBoundary</a>(region1,line_mesh);</div><div class="line"></div><div class="line">-- Create meshers</div><div class="line"><a class="code" href="../../d1/d9b/group___lua_surface_mesher_ga7167fdac9f720677dc78a356ca1c391b.html#ga7167fdac9f720677dc78a356ca1c391b">chiSurfaceMesherCreate</a>(SURFACEMESHER_PREDEFINED);</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher_ga49963c2a7ea611bc23ecab6e61dc4cb5.html#ga49963c2a7ea611bc23ecab6e61dc4cb5">chiVolumeMesherCreate</a>(VOLUMEMESHER_LINEMESH1D);</div><div class="line"></div><div class="line">-- Execute meshing</div><div class="line"><a class="code" href="../../d1/d9b/group___lua_surface_mesher_ga3e282401531b27d35df9c5d19f132b37.html#ga3e282401531b27d35df9c5d19f132b37">chiSurfaceMesherExecute</a>();</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher_gaaa70b33a0935af1be76df133113fb7f4.html#gaaa70b33a0935af1be76df133113fb7f4">chiVolumeMesherExecute</a>();</div><div class="line"></div><div class="line">-- Set Material IDs</div><div class="line">vol0 = <a class="code" href="../../d9/d32/group___lua_logic_volumes_gad12fbbcc9338d45e2085811244e121cb.html#gad12fbbcc9338d45e2085811244e121cb">chiLogicalVolumeCreate</a>(RPP,-1000,1000,-1000,1000,-1000,1000)</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher_ga877810586ad18728337d7cab842242a8.html#ga877810586ad18728337d7cab842242a8">chiVolumeMesherSetProperty</a>(MATID_FROMLOGICAL,vol0,0)</div></div><!-- fragment --><p>Some notably new items is the different volume mesher (VOLUMEMESHER_LINEMESH1D). Note also that even though there is no notion of a surfacemesher we still need to use a pass-through SurfaceMesher. This helps to keep the coding pipeline simple.</p>
<p>We also set the material id's the same we we do any mesh format.</p>
<h2>Step 3 - Add a material with a transport cross-section</h2>
<p>Similar to the diffusion tutorial we have to create a material, then add a property to it, and then to set the property.</p>
<div class="fragment"><div class="line">material0 = <a class="code" href="../../d7/d11/group___lua_physics_materials_ga8d13197b28523323399a61ecbe703ba7.html#ga8d13197b28523323399a61ecbe703ba7">chiPhysicsAddMaterial</a>(<span class="stringliteral">&quot;Test Material&quot;</span>);</div><div class="line"></div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials_gaca0d6b0498258b0bbedcf9f3c13a30ed.html#gaca0d6b0498258b0bbedcf9f3c13a30ed">chiPhysicsMaterialAddProperty</a>(material0,TRANSPORT_XSECTIONS)</div><div class="line"></div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials_ga2f1cdfe3dc85457d4fc4780d37e73270.html#ga2f1cdfe3dc85457d4fc4780d37e73270">chiPhysicsMaterialSetProperty</a>(material0,</div><div class="line">                              TRANSPORT_XSECTIONS,</div><div class="line">                              SIMPLEXS1,</div><div class="line">                              1,     --Num grps</div><div class="line">                              1.0,   --Sigma_t</div><div class="line">                              1.0)   --Scattering ratio</div></div><!-- fragment --><p>The general material property TRANSPORT_XSECTIONS is used for non-fission transport materials. Simple cross-sections can be specified by using the operation SIMPLEXS1 which expects the number of groups, the total cross-section, and then the scattering ratio.</p>
<h2>Step 4 - Add Transport physics</h2>
<div class="fragment"><div class="line">phys1 = chiNPTransportCreateSolver()</div><div class="line"><a class="code" href="../../dc/d4e/group___lua_solver_ga15162e7e9864bb9dcf30de0ce04a6803.html#ga15162e7e9864bb9dcf30de0ce04a6803">chiSolverAddRegion</a>(phys1,region1)</div><div class="line"></div><div class="line">chiNPTCreateGroup(phys1)</div><div class="line"></div><div class="line">pqaud = <a class="code" href="../../de/d37/group___lua_quadrature_gae40b4f9db8e78423ff850a2b7b51fc48.html#gae40b4f9db8e78423ff850a2b7b51fc48">chiCreateProductQuadrature</a>(GAUSS_LEGENDRE,32)</div><div class="line"></div><div class="line">--========== Groupset def</div><div class="line">gs0 = chiNPTCreateGroupset(phys1)</div><div class="line">chiNPTGroupsetAddGroups(phys1,gs0,0,0)</div><div class="line">chiNPTGroupsetSetQuadrature(phys1,gs0,pquad)</div><div class="line"></div><div class="line">--========== Boundary conditions</div><div class="line">bsrc = {0.5}</div><div class="line">chiNPTSetProperty(phys1,BOUNDARY_CONDITION,ZMIN,INCIDENT_ISOTROPIC,bsrc);</div><div class="line"></div><div class="line">--========== Solvers</div><div class="line">chiNPTSetProperty(phys1,DISCRETIZATION_METHOD,PWLD1D)</div><div class="line">chiNPTSetProperty(phys1,SCATTERING_ORDER,0)</div></div><!-- fragment --><p>A transport solver is invoked by using a call to chiNPTransportCreateSolver(). This creates a derived physics solver so the mesh region gets added to the solver using the generic call <a class="el" href="../../dc/d4e/group___lua_solver_ga15162e7e9864bb9dcf30de0ce04a6803.html#ga15162e7e9864bb9dcf30de0ce04a6803">chiSolverAddRegion()</a>. Past this point we need to create the single required group with chiNPTCreateGroup() and then a quadrature rule for integration of the angular fluxes. Since we are dealing with a 1D simulation we will be integration over theta translating to a cosine from -1 to 1 and therefore the appropriate quadrature rule would be a Gauss-Legendre quadrature rule. For this we use a call to <a class="el" href="../../de/d37/group___lua_quadrature_gae40b4f9db8e78423ff850a2b7b51fc48.html#gae40b4f9db8e78423ff850a2b7b51fc48">chiCreateProductQuadrature()</a> and specifying GAUSS_LEGENDRE as the rule and 32 number of discrete angles.</p>
<p>The next step in the process is to assign a group-set. Group-sets are very useful aggregation features in higher dimension simulations but here we only have a single groupset. The group-set is created with a call to chiNPTCreateGroupset(). Next we add groups to the group-set using a range, however, since we only have one group here the range will be 0 to 0. The final piece of a groupset is to add a quadrature which is achieved with a call to chiNPTGroupsetSetQuadrature().</p>
<h2>Step 5 - Initialize and Execute</h2>
<div class="fragment"><div class="line">chiNPTInitialize(phys1)</div><div class="line">chiNPTExecute(phys1)</div></div><!-- fragment --><p>This should be intuitive.</p>
<h2>Step 6 - Add output</h2>
<div class="fragment"><div class="line">fflist,count = chiNPTGetScalarFieldFunctionList(phys1)</div><div class="line"></div><div class="line">cline = <a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gadd09753e95c7cb6f360414c2636dcb4b.html#gadd09753e95c7cb6f360414c2636dcb4b">chiFFInterpolationCreate</a>(LINE)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(cline,LINE_FIRSTPOINT,0.0,0.0,0.0+xmin)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(cline,LINE_SECONDPOINT,0.0,0.0, L+xmin)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(cline,LINE_NUMBEROFPOINTS, 50)</div><div class="line"></div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(cline,ADD_FIELDFUNCTION,fflist[1])</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga78a809d7b87b5a1ed0477e267dbf9ae8.html#ga78a809d7b87b5a1ed0477e267dbf9ae8">chiFFInterpolationInitialize</a>(cline)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga59d6466cb98ad12488119d9d96aac938.html#ga59d6466cb98ad12488119d9d96aac938">chiFFInterpolationExecute</a>(cline)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga9a74f7ad2381a000bfd195cfaf103093.html#ga9a74f7ad2381a000bfd195cfaf103093">chiFFInterpolationExportPython</a>(cline)</div><div class="line"></div><div class="line">if (chi_location_id == 0) then</div><div class="line">    local handle = io.popen(&quot;python ZLFFI00.py&quot;)</div><div class="line">end</div></div><!-- fragment --><p>Instead of using a SLICE interpolator we instead opt to use a LINE interpolator. A line-interpolator needs two points as the initial and final point (i.e. LINE_FIRSTPOINT and LINE_SECONDPOINT) as well as the total number of points LINE_NUMBEROFPOINTS. Finally add the first available scalar field field function to the interpolator.</p>
<p>The output should look as follows:</p>
<div class="image">
<img src="../../Tut3Output.png" alt="Tut3Output.png" width="350px"/>
<div class="caption">
Figure 1 - Output of the 1D simulation</div></div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">index</a></li><li class="navelem"><a class="el" href="../../d8/d2d/_tutorial00.html">Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
