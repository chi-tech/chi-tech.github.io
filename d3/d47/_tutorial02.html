<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Chi-Tech: Tutorial 2: Adding basic output</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Logo2_Small.bmp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Chi-Tech
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d3/d47/_tutorial02.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 2: Adding basic output </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Solver modules in ChiTech connect their solution information to a concept called a <b>Field Function</b>. A field function is considered fully defined when it is connected to both a grid (mesh) and a spatial discretization.</p>
<div class="image">
<img src="../../FieldFunctionHierarchy.png" alt="FieldFunctionHierarchy.png" width="600px"/>
<div class="caption">
Figure 1 - Hierarchy of field functions</div></div>
<h2>Step 1 - Make a copy of Tutorial01 input</h2>
<p>In the same folder (or any of your choice) make a copy of the input you used for Tutorial 1. We will be adding some items to this input file.</p>
<h2>Step 2 - Obtain a list of field functions associated with the solver</h2>
<div class="fragment"><div class="line">fflist,count = <a class="code" href="../../dc/d4e/group___lua_solver_gaf32795816e761d2c9bf86f65efeff25d.html#gaf32795816e761d2c9bf86f65efeff25d">chiGetFieldFunctionList</a>(phys1)</div></div><!-- fragment --><p>The funcation call <a class="el" href="../../dc/d4e/group___lua_solver_gaf32795816e761d2c9bf86f65efeff25d.html#gaf32795816e761d2c9bf86f65efeff25d">chiGetFieldFunctionList()</a> provides us with two items. A lua-table and a count of how many items there are in the table. The items in "fflist" are the text names of the field functions. Each solver has its own defaults.</p>
<h2>Step 3 - Create a slice interpolator</h2>
<div class="fragment"><div class="line">slice1 = <a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gadd09753e95c7cb6f360414c2636dcb4b.html#gadd09753e95c7cb6f360414c2636dcb4b">chiFFInterpolationCreate</a>(SLICE)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(slice1,SLICE_POINT,0.0,0.0,1.5)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(slice1,ADD_FIELDFUNCTION,fflist[1])</div></div><!-- fragment --><p>The first call creates a interpolator of type SLICE. At the time of writing this tutorial we support LINE, SLICE and VOLUME. The default orientation of a slice interpolator is with the cutting plane's normal pointing in the direction of \( \hat{k} \) and the reference point at (0,0,0). We can keep the same orientation but move the reference point to the center of the extrusion (i.e. 1.5). This is achieved with a call to <a class="el" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty()</a> with a property index SLICE_POINT. The last line here is to add a field function to this interpolator. We use the same function but this time with a property index ADD_FIELDFUNCTION.</p>
<h2>Step 4 - Initialize and execute</h2>
<p>For very complex meshes it might be prudent to perform initialization before actually solving the systems, since this established the necessary interpolation parameters and allows one to execute the interpolator multiple times after that with minimal cost.</p>
<div class="fragment"><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga78a809d7b87b5a1ed0477e267dbf9ae8.html#ga78a809d7b87b5a1ed0477e267dbf9ae8">chiFFInterpolationInitialize</a>(slice1)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga59d6466cb98ad12488119d9d96aac938.html#ga59d6466cb98ad12488119d9d96aac938">chiFFInterpolationExecute</a>(slice1)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga9a74f7ad2381a000bfd195cfaf103093.html#ga9a74f7ad2381a000bfd195cfaf103093">chiFFInterpolationExportPython</a>(slice1)</div></div><!-- fragment --><p>The <a class="el" href="../../d9/dfa/group___lua_f_f_interpol_ga78a809d7b87b5a1ed0477e267dbf9ae8.html#ga78a809d7b87b5a1ed0477e267dbf9ae8">chiFFInterpolationInitialize()</a> and <a class="el" href="../../d9/dfa/group___lua_f_f_interpol_ga59d6466cb98ad12488119d9d96aac938.html#ga59d6466cb98ad12488119d9d96aac938">chiFFInterpolationExecute()</a> should be intuitive to understand. The last function call here is <a class="el" href="../../d9/dfa/group___lua_f_f_interpol_ga9a74f7ad2381a000bfd195cfaf103093.html#ga9a74f7ad2381a000bfd195cfaf103093">chiFFInterpolationExportPython()</a> which is a utility to export a slice to a python file. Inside this python file there are some default visualization commands but the major utility here is that the field function is now represented as python variables so that the user can define custom visualizations.</p>
<h2>Step 5 - Run the python file</h2>
<p>Being a useful scripting system, the lua console can itself invoke processes. Here the default export name of the python file will be "ZPFFI00.py". Its actually "ZPFFI0", for Plane-Field-Function-Interpolator-0 but the last digit denotes the processor identification in such a way that the user merely needs to execute the 0-index and the rest will be loaded.</p>
<div class="fragment"><div class="line">local handle = io.popen(<span class="stringliteral">&quot;python ZPFFI00.py&quot;</span>)</div></div><!-- fragment --><p>The output procuded is shown below:</p>
<div class="image">
<img src="../../FFOutput.png" alt="FFOutput.png" width="600px"/>
<div class="caption">
Figure 2 - Output produced by python script</div></div>
<h2>Fully commented code</h2>
<div class="fragment"><div class="line">--############################################### Setup mesh</div><div class="line"><a class="code" href="../../da/d92/group___lua_mesh_handler_ga7d6dee3f32f771fa919138ab80dcdcf4.html#ga7d6dee3f32f771fa919138ab80dcdcf4">chiMeshHandlerCreate</a>()</div><div class="line"></div><div class="line">newSurfMesh = <a class="code" href="../../db/dc8/group___lua_surface_mesh_ga83af311a7fbb23a8a89e4da6275278b2.html#ga83af311a7fbb23a8a89e4da6275278b2">chiSurfaceMeshCreate</a>();</div><div class="line"><a class="code" href="../../db/dc8/group___lua_surface_mesh_gabfd0722a36eedaee766f66d42ee532b8.html#gabfd0722a36eedaee766f66d42ee532b8">chiSurfaceMeshImportFromOBJFile</a>(newSurfMesh,</div><div class="line">        &quot;CHI_RESOURCES/TestObjects/SquareMesh2x2Quads.obj&quot;)</div><div class="line"></div><div class="line">-- Setup Region</div><div class="line">region1 = <a class="code" href="../../df/dda/group___lua_region_ga12d91bac4cbde16ef605143f6437e806.html#ga12d91bac4cbde16ef605143f6437e806">chiRegionCreate</a>()</div><div class="line"><a class="code" href="../../df/dda/group___lua_region_ga88d006b2cf5cf7021f9d0c64d30a156a.html#ga88d006b2cf5cf7021f9d0c64d30a156a">chiRegionAddSurfaceBoundary</a>(region1,newSurfMesh);</div><div class="line"></div><div class="line">-- Create meshers</div><div class="line"><a class="code" href="../../d1/d9b/group___lua_surface_mesher_ga7167fdac9f720677dc78a356ca1c391b.html#ga7167fdac9f720677dc78a356ca1c391b">chiSurfaceMesherCreate</a>(SURFACEMESHER_PREDEFINED);</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher_ga49963c2a7ea611bc23ecab6e61dc4cb5.html#ga49963c2a7ea611bc23ecab6e61dc4cb5">chiVolumeMesherCreate</a>(VOLUMEMESHER_EXTRUDER);</div><div class="line"></div><div class="line">-- Setup extrusion layers</div><div class="line">subdivisions=3</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher_ga877810586ad18728337d7cab842242a8.html#ga877810586ad18728337d7cab842242a8">chiVolumeMesherSetProperty</a>(EXTRUSION_LAYER,3.0,subdivisions,&quot;My Layer&quot;);</div><div class="line"></div><div class="line">--  Execute meshing</div><div class="line"><a class="code" href="../../d1/d9b/group___lua_surface_mesher_ga3e282401531b27d35df9c5d19f132b37.html#ga3e282401531b27d35df9c5d19f132b37">chiSurfaceMesherExecute</a>();</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher_gaaa70b33a0935af1be76df133113fb7f4.html#gaaa70b33a0935af1be76df133113fb7f4">chiVolumeMesherExecute</a>();</div><div class="line"></div><div class="line">material = <a class="code" href="../../d7/d11/group___lua_physics_materials_ga8d13197b28523323399a61ecbe703ba7.html#ga8d13197b28523323399a61ecbe703ba7">chiPhysicsAddMaterial</a>(&quot;Test Material&quot;);</div><div class="line"></div><div class="line">-- Set Material IDs</div><div class="line">vol0 = <a class="code" href="../../d9/d32/group___lua_logic_volumes_gad12fbbcc9338d45e2085811244e121cb.html#gad12fbbcc9338d45e2085811244e121cb">chiLogicalVolumeCreate</a>(RPP,-1000,1000,-1000,1000,-1000,1000)</div><div class="line"><a class="code" href="../../d4/d3a/group___lua_volume_mesher_ga877810586ad18728337d7cab842242a8.html#ga877810586ad18728337d7cab842242a8">chiVolumeMesherSetProperty</a>(MATID_FROMLOGICAL,vol0,material)</div><div class="line"></div><div class="line">-- Export visualization</div><div class="line"><a class="code" href="../../df/dda/group___lua_region_gadf6f74ed713e24ef8c44516fc2a44772.html#gadf6f74ed713e24ef8c44516fc2a44772">chiRegionExportMeshToObj</a>(region1,&quot;Tutorial01Mesh.obj&quot;,true)</div><div class="line"></div><div class="line">--<span class="preprocessor">############################################### Add material properties</span></div><div class="line"></div><div class="line"></div><div class="line">-- Set material properties</div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials_gaca0d6b0498258b0bbedcf9f3c13a30ed.html#gaca0d6b0498258b0bbedcf9f3c13a30ed">chiPhysicsMaterialAddProperty</a>(material,SCALAR_VALUE,<span class="stringliteral">&quot;k&quot;</span>)</div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials_ga2f1cdfe3dc85457d4fc4780d37e73270.html#ga2f1cdfe3dc85457d4fc4780d37e73270">chiPhysicsMaterialSetProperty</a>(material,&quot;k&quot;,SINGLE_VALUE,1.0)</div><div class="line"></div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials_gaca0d6b0498258b0bbedcf9f3c13a30ed.html#gaca0d6b0498258b0bbedcf9f3c13a30ed">chiPhysicsMaterialAddProperty</a>(material,SCALAR_VALUE,&quot;q&quot;)</div><div class="line"><a class="code" href="../../d7/d11/group___lua_physics_materials_ga2f1cdfe3dc85457d4fc4780d37e73270.html#ga2f1cdfe3dc85457d4fc4780d37e73270">chiPhysicsMaterialSetProperty</a>(material,&quot;q&quot;,SINGLE_VALUE,1.0)</div><div class="line"></div><div class="line"></div><div class="line">--<span class="preprocessor">############################################### Setup Physics</span></div><div class="line">phys1 = <a class="code" href="../../de/d15/group___lua_diffusion_gae447e896898d4d16fa54a1338511eeb5.html#gae447e896898d4d16fa54a1338511eeb5">chiDiffusionCreateSolver</a>();</div><div class="line"><a class="code" href="../../dc/d4e/group___lua_solver_ga15162e7e9864bb9dcf30de0ce04a6803.html#ga15162e7e9864bb9dcf30de0ce04a6803">chiSolverAddRegion</a>(phys1,region1)</div><div class="line"><a class="code" href="../../de/d15/group___lua_diffusion_ga5c6d2bdff1c9301cd13d0c5e9f22f763.html#ga5c6d2bdff1c9301cd13d0c5e9f22f763">chiDiffusionSetProperty</a>(phys1,DISCRETIZATION_METHOD,PWLC);</div><div class="line"><a class="code" href="../../de/d15/group___lua_diffusion_ga5c6d2bdff1c9301cd13d0c5e9f22f763.html#ga5c6d2bdff1c9301cd13d0c5e9f22f763">chiDiffusionSetProperty</a>(phys1,RESIDUAL_TOL,1.0e-4)</div><div class="line"></div><div class="line">-- Initialize and Execute Solver</div><div class="line"><a class="code" href="../../de/d15/group___lua_diffusion_ga2ddcaaab893f78dc401a4cb7d53d7e09.html#ga2ddcaaab893f78dc401a4cb7d53d7e09">chiDiffusionInitialize</a>(phys1)</div><div class="line"><a class="code" href="../../de/d15/group___lua_diffusion_ga0bbc893ec4d87ff00001daf2290bbe68.html#ga0bbc893ec4d87ff00001daf2290bbe68">chiDiffusionExecute</a>(phys1)</div><div class="line"></div><div class="line"></div><div class="line">--############################################### Setup FF interpolator</div><div class="line">fflist,count = <a class="code" href="../../dc/d4e/group___lua_solver_gaf32795816e761d2c9bf86f65efeff25d.html#gaf32795816e761d2c9bf86f65efeff25d">chiGetFieldFunctionList</a>(phys1)</div><div class="line">slice1 = <a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gadd09753e95c7cb6f360414c2636dcb4b.html#gadd09753e95c7cb6f360414c2636dcb4b">chiFFInterpolationCreate</a>(SLICE)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(slice1,SLICE_POINT,0.0,0.0,1.5)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_gae63aac110ac8a0e4a63da7b81f05ffe7.html#gae63aac110ac8a0e4a63da7b81f05ffe7">chiFFInterpolationSetProperty</a>(slice1,ADD_FIELDFUNCTION,fflist[1])</div><div class="line"></div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga78a809d7b87b5a1ed0477e267dbf9ae8.html#ga78a809d7b87b5a1ed0477e267dbf9ae8">chiFFInterpolationInitialize</a>(slice1)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga59d6466cb98ad12488119d9d96aac938.html#ga59d6466cb98ad12488119d9d96aac938">chiFFInterpolationExecute</a>(slice1)</div><div class="line"><a class="code" href="../../d9/dfa/group___lua_f_f_interpol_ga9a74f7ad2381a000bfd195cfaf103093.html#ga9a74f7ad2381a000bfd195cfaf103093">chiFFInterpolationExportPython</a>(slice1)</div><div class="line"></div><div class="line">local handle = io.popen(&quot;python ZPFFI00.py&quot;)</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">index</a></li><li class="navelem"><a class="el" href="../../d8/d2d/_tutorial00.html">Tutorials</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
